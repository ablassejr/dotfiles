# --- Aliases ---
alias mkexec="sudo -S chmod +x"
alias la="eza --long --sort modified --tree --level 3 | most"
alias SUDO_PASS="lpass show --password 1279211307193658237OD"
alias ll='ls -lh'
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias ce='chezmoi edit'
alias ca='chezmoi apply'
alias gmp='git magic -apm'
alias clr='clear'
alias hwsim='/home/draogo/Work/misc-projects/Nand2Tetris/Simulator/InstallDir/HardwareSimulator.sh'
alias la="eza --long --tree --level 3"
alias bashconfig="nvim ~/.bashrc"
alias zshconfig="nvim ~/.zshrc"
alias lmost="ls -la | most"
alias mkexec="sudo -S chmod +x"
alias jupyter-tui="source ~/.local/share/jupyter-tui/.venv/bin/activate && python ~/.local/share/jupyter-tui/main.py"
alias savesession="hyprsession --mode save-and-exit && shutdown now"
alias nvimc="NVIM_APPNAME=craftzdog/dotfiles-public/.config/nvim nvim"
alias nvidec="NVIM_APPNAME=craftzdog/dotfiles-public/.config/nvim neovide"
alias fzfrm="fzf | xargs -I {} rm {}"
alias nvimm="NVIM_APPNAME=mimikun/dot_config/nvim nvim"
alias nvidem="NVIM_APPNAME=mimikun/dotfiles/dot_config/nvim neovide"
alias nvimp="NVIM_APPNAME=nvim-personal nvim"
alias nvidep="NVIM_APPNAME=nvim-personal neovide"
alias releasesudo="faillock --user \$(whoami) --reset"
alias nvide=neovide
alias nvimdir="nvim \$(find . -type d | fzf)"
alias nvimfile="nvim \$(fzf)"
alias nvidedir="nvide \$(find . -type d | fzf)"
alias nvidefile="nvide \$(fzf)"
alias codexfull="codex --search --sandbox danger-full-access --dangerously-bypass-approvals-and-sandbox"
alias utar="tar -xf"
alias ghosttyconfig=~/.config/ghostty/config
# --- Environment Variables ---
# MacPorts Installer addition on 2025-12-14_at_00:43:58: adding an appropriate PATH variable for use with MacPorts.
export PATH="/opt/local/bin:/opt/local/sbin:$PATH"
# Finished adapting your PATH environment variable for use with MacPorts.
export mysql_password="Draogo@2003"

# Homebrew
if [[ -x /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -x /usr/local/bin/brew ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
fi

# Mise (as generated by `mise activate zsh`) - keep PATH/tooling consistent in login shells.
if [[ -x /opt/homebrew/bin/mise ]]; then
  export MISE_SHELL=zsh
  if [[ -z "${__MISE_ORIG_PATH:-}" ]]; then
    export __MISE_ORIG_PATH="$PATH"
  fi
  export __MISE_ZSH_PRECMD_RUN=0

  mise() {
    local command
    command="${1:-}"
    if [[ "$#" = 0 ]]; then
      command /opt/homebrew/bin/mise
      return
    fi
    shift

    case "$command" in
    deactivate|shell|sh)
      if [[ ! " $@ " =~ " --help " ]] && [[ ! " $@ " =~ " -h " ]]; then
        eval "$(command /opt/homebrew/bin/mise "$command" "$@")"
        return $?
      fi
      ;;
    esac
    command /opt/homebrew/bin/mise "$command" "$@"
  }

  _mise_hook() { eval "$(/opt/homebrew/bin/mise hook-env -s zsh)"; }
  _mise_hook_precmd() { eval "$(/opt/homebrew/bin/mise hook-env -s zsh --reason precmd)"; }
  _mise_hook_chpwd() { eval "$(/opt/homebrew/bin/mise hook-env -s zsh --reason chpwd)"; }

  typeset -ag precmd_functions
  if [[ -z "${precmd_functions[(r)_mise_hook_precmd]+1}" ]]; then
    precmd_functions=( _mise_hook_precmd ${precmd_functions[@]} )
  fi

  typeset -ag chpwd_functions
  if [[ -z "${chpwd_functions[(r)_mise_hook_chpwd]+1}" ]]; then
    chpwd_functions=( _mise_hook_chpwd ${chpwd_functions[@]} )
  fi

  _mise_hook
  if [[ -z "${_mise_cmd_not_found:-}" ]]; then
    _mise_cmd_not_found=1
    [[ -n "$(declare -f command_not_found_handler)" ]] && eval "${$(declare -f command_not_found_handler)/command_not_found_handler/_command_not_found_handler}"

    function command_not_found_handler() {
      if [[ "$1" != "mise" && "$1" != "mise-"* ]] && /opt/homebrew/bin/mise hook-not-found -s zsh -- "$1"; then
        _mise_hook
        "$@"
      elif [[ -n "$(declare -f _command_not_found_handler)" ]]; then
        _command_not_found_handler "$@"
      else
        echo "zsh: command not found: $1" >&2
        return 127
      fi
    }
  fi
fi

# Extra local bins (only if not already in PATH)
[[ ":$PATH:" != *":$HOME/.local/bin:"* ]] && export PATH="$HOME/.local/bin:$PATH"
[[ ":$PATH:" != *":/usr/local/bin:"* ]] && export PATH="/usr/local/bin:$PATH"

# Everything below is interactive-only.
if [[ -o interactive ]]; then
  # Enable Powerlevel10k instant prompt. Keep this near the top of zsh init.
  # Any code that may produce output or require input must go ABOVE this block.
  if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
    source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
  fi

  export EDITOR="nvim"

  setopt autocd            # type folder name to cd
  setopt correct           # correct small typos in ALL commands (not just cd)

  # History configuration
  HISTFILE=~/.zsh_history
  HISTSIZE=50000
  SAVEHIST=50000
  setopt append_history
  setopt share_history
  setopt hist_ignore_dups
  setopt hist_ignore_space
  setopt hist_reduce_blanks

  # Optional private env file
  [[ -e "$HOME/.env" ]] && source "$HOME/.env"

  # --- fzf integration (macOS Homebrew locations) ---
  [[ -r /opt/homebrew/opt/fzf/shell/key-bindings.zsh ]] && source /opt/homebrew/opt/fzf/shell/key-bindings.zsh
  [[ -r /usr/local/opt/fzf/shell/key-bindings.zsh   ]] && source /usr/local/opt/fzf/shell/key-bindings.zsh

  _source_first_readable() {
    local file
    for file in "$@"; do
      [[ -r "$file" ]] || continue
      source "$file"
      return 0
    done
    return 1
  }

  if [[ -f "$HOME/.zinit/bin/zinit.zsh" ]]; then
    source "$HOME/.zinit/bin/zinit.zsh"

    _zinit_light_if_present() {
      local repo="$1"
      local plugins_dir="${ZINIT[PLUGINS_DIR]:-$HOME/.zinit/plugins}"
      local plugin_dir="${plugins_dir}/${repo/\//---}"
      [[ -d "$plugin_dir" ]] || return 1
      zinit light "$repo"
    }

    # Ensure completion definitions are on `fpath` before `compinit`.
    _zinit_light_if_present zsh-users/zsh-completions

    autoload -Uz compinit
    mkdir -p "${XDG_CACHE_HOME:-$HOME/.cache}"
    compinit -d "${XDG_CACHE_HOME:-$HOME/.cache}/zcompdump-${ZSH_VERSION}"

    # fzf completion requires `compinit`.
    [[ -r /opt/homebrew/opt/fzf/shell/completion.zsh ]] && source /opt/homebrew/opt/fzf/shell/completion.zsh
    [[ -r /usr/local/opt/fzf/shell/completion.zsh   ]] && source /usr/local/opt/fzf/shell/completion.zsh

    # Autocomplete suggestions while typing
    ZSH_AUTOSUGGEST_STRATEGY=(history completion)
    _zinit_light_if_present zsh-users/zsh-autosuggestions || _source_first_readable \
      /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh \
      /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh \
      /opt/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh

    _zinit_light_if_present Aloxaf/fzf-tab
    _zinit_light_if_present rupa/z
    _zinit_light_if_present ael-code/zsh-colored-man-pages
    _zinit_light_if_present hlissner/zsh-autopair

    # Theme / prompt
    GITSTATUS_LOG_LEVEL=ERROR
    _zinit_light_if_present romkatv/powerlevel10k
    [[ -f "$HOME/.p10k.zsh" ]] && source "$HOME/.p10k.zsh"

    # Keep syntax highlighting last.
    _zinit_light_if_present zsh-users/zsh-syntax-highlighting || _source_first_readable \
      /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh \
      /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh \
      /opt/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
  else
    autoload -Uz compinit && compinit
    ZSH_AUTOSUGGEST_STRATEGY=(history completion)
    _source_first_readable \
      /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh \
      /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh \
      /opt/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh
    _source_first_readable \
      /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh \
      /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh \
      /opt/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
  fi

  # === Tmux Auto Background Window for Async Processes ===
  if command -v tmux &>/dev/null; then
    function __tmux_bg_wrapper() {
      local cmd="$@"
      local cmd_name="${cmd%% *}"
      local window_name="bg-${cmd_name}-$(date +%s)"

      if [[ -n "$TMUX" ]]; then
        tmux new-window -d -n "$window_name" "$cmd; echo '\n--- Process completed. Press any key to close this window ---'; read -k 1"
        echo "[tmux] Background process started in window: $window_name"
      else
        local session_name="bg-tasks"
        if ! tmux has-session -t "$session_name" 2>/dev/null; then
          tmux new-session -d -s "$session_name" -n "$window_name" "$cmd; echo '\n--- Process completed. Press any key to close this window ---'; read -k 1"
          echo "[tmux] Created session '$session_name' with background process in window: $window_name"
        else
          tmux new-window -d -t "$session_name" -n "$window_name" "$cmd; echo '\n--- Process completed. Press any key to close this window ---'; read -k 1"
          echo "[tmux] Background process started in session '$session_name', window: $window_name"
        fi
        echo "[tmux] Attach to view: tmux attach-session -t $session_name"
      fi
    }

    alias tmuxbg='__tmux_bg_wrapper'

    function neovide() {
      __tmux_bg_wrapper "command neovide $@"
    }
  fi
  # === End Tmux Auto Background Window ===
fi
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
export LDFLAGS="-L/opt/homebrew/opt/postgresql@15/lib"
export CPPFLAGS="-I/opt/homebrew/opt/postgresql@15/include"
export CLAUDE_CODE_OAUTH_TOKEN=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
