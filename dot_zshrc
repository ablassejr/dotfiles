# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# --- Oh My Zsh Setup ---
# Check if Oh My Zsh is installed, if not, download and install it
if [[ ! -d "$HOME/.oh-my-zsh" ]]; then
    print -P "%F{33}Oh My Zsh not found. Installing...%f"
    git clone https://github.com/ohmyzsh/ohmyzsh.git "$HOME/.oh-my-zsh"
    if [[ $? -eq 0 ]]; then
        print -P "%F{green}Oh My Zsh installed successfully!%f"
    else
        print -P "%F{red}Error: Oh My Zsh installation failed%f"
    fi
fi

# Initialize Oh My Zsh if it exists
if [[ -d "$HOME/.oh-my-zsh" ]]; then
    export ZSH="$HOME/.oh-my-zsh"
    # Source Oh My Zsh
    if [[ -f "$ZSH/oh-my-zsh.sh" ]]; then
        source "$ZSH/oh-my-zsh.sh"
    else
        print -P "%F{red}Error: Oh My Zsh installation appears incomplete%f"
    fi
fi

# --- Zinit Setup ---
if [[ ! -f ~/.zinit/bin/zinit.zsh ]]; then
    print -P "%F{33}Installing zinitâ€¦%f"
    mkdir -p ~/.zinit
    git clone https://github.com/zdharma-continuum/zinit.git ~/.zinit/bin
fi

# Only source if zinit exists
if [[ -f ~/.zinit/bin/zinit.zsh ]]; then
    source ~/.zinit/bin/zinit.zsh
else
    print -P "%F{red}Error: zinit failed to install%f"
    return 1
fi

# --- Basic settings ---
export EDITOR="nvim"

# Add common local bin paths (Linux-friendly) - only if not already in PATH
[[ ":$PATH:" != *":$HOME/.local/bin:"* ]] && export PATH="$HOME/.local/bin:$PATH"
[[ ":$PATH:" != *":/usr/local/bin:"* ]] && export PATH="/usr/local/bin:$PATH"

setopt autocd            # type folder name to cd
setopt correct           # correct small typos in ALL commands (not just cd)

# History configuration
HISTFILE=~/.zsh_history
HISTSIZE=50000
SAVEHIST=50000
setopt append_history        # append to history file, don't overwrite
setopt share_history         # share history between all sessions
setopt hist_ignore_dups      # don't record duplicate entries
setopt hist_ignore_space     # don't record commands starting with space
setopt hist_reduce_blanks    # remove superfluous blanks from history

# --- fzf integration (load before fzf-tab plugin) ---
# If fzf installed via package manager, these may exist (load silently):
[[ -r /usr/share/doc/fzf/examples/key-bindings.zsh ]] && source /usr/share/doc/fzf/examples/key-bindings.zsh 2>/dev/null
[[ -r /usr/share/doc/fzf/examples/completion.zsh     ]] && source /usr/share/doc/fzf/examples/completion.zsh 2>/dev/null

# If you installed fzf with its install script, use:
# [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# --- Plugins ---
# Load plugins asynchronously for faster startup
autoload -Uz compinit && compinit

# Syntax highlighting
zinit light zsh-users/zsh-syntax-highlighting

# Autosuggestions
zinit light zsh-users/zsh-autosuggestions

# Extra completions
zinit light zsh-users/zsh-completions

# Fuzzy finder tab completion (load AFTER fzf)
zinit light Aloxaf/fzf-tab

# Directory jumper (like autojump)
zinit light rupa/z

# Colorized man pages
zinit light ael-code/zsh-colored-man-pages

# Auto-close brackets/quotes
zinit light hlissner/zsh-autopair

# --- Theme / Prompt ---
# Suppress gitstatus errors during initialization
GITSTATUS_LOG_LEVEL=ERROR
zinit light romkatv/powerlevel10k
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh

# --- Aliases ---
alias ll='ls -lh'
alias la='ls -lha'
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
